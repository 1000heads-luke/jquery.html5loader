(function(b){b.fn.extend({html5Loader:function(e){var d=this,K={preloaderType:"circular",currPercentage:0,getFilesToLoadJSON:null,positionX:d.width()/2,positionY:d.height()/2,lineWidth:5,color:"#ffffff",font:"normal 11px Arial",fullScreen:!0,onComplete:function(){},onItemLoaded:function(){},pathToFallbackGif:"../preloaderFallback.gif",radius:40,glowColor:null,debugMode:!1},e=b.extend(K,e),m=e.currPercentage,n=e.positionX,l=e.positionY,B=e.lineWidth,q=e.color,y=e.font,v=e.getFilesToLoadJSON,C=e.onComplete,
z=e.onItemLoaded,w=e.pathToFallbackGif,L=e.radius,D=e.fullScreen,r=e.glowColor;debugMode=e.debugMode;var h=null,E=Math.PI,F=1.5*E,G=0,g=b(window),x=void 0==b(d).attr("id")?b(d).attr("class"):b(d).attr("id"),p=0,A=0,j=0,s=[],o=[],i=[],t=[],M=Modernizr.video.h264,N=Modernizr.video.ogg,O=Modernizr.video.webm,k=[],H=0,I=[],J=[],f=this;f.fileExtension=function(a){var u=a.lastIndexOf("."),b=a.length;-1!=u&&b!=u+1?(a=a.split("."),a=a[a.length-1].toLowerCase()):a="No extension found";return a};f.setFullscreen=
function(){!0==debugMode&&console.log("Setting Full screen");d.css({position:"fixed",height:g.height(),width:g.width(),"z-index":98,top:0});n=d.width()/2;l=d.height()/2;b(d).html('<canvas id="html5Canvas'+x+'" width="'+b(d).width()+'px "height="'+b(d).height()+'px"></canvas>');h=document.getElementById("html5Canvas"+x);b(h).css({position:"fixed",top:g.height()/2-b(h).height()/2,left:g.width()/2-b(h).width()/2,"z-index":99});g.bind("resize.CenterCanvas",function(){b(h).css({top:g.height()/2-b(h).height()/
2,left:g.width()/2-b(h).width()/2});d.css({position:"fixed",height:g.height(),width:g.width(),"z-index":98})})};f.fillFilesArray=function(a,b,d,c){A+=b;!0==debugMode&&console.log("Getting file:"+d+" Size: "+b);s.push(a);o.push(b);i.push(d);t.push(c)};f.startLoadElements=function(){b(s).each(function(a,u){var d="?"+Math.random();i[a]+=d;if(0<o[a]&&("IMAGE"==t[a]&&(d=new Image,d.src=i[a],b(d).on("load",function(){b(s[a])&&new z(i[a],u);j+=o[a];f.updatePercentage(j);!0==debugMode&&console.log("File Loaded:"+
i[a])}),!0==debugMode&&console.log("Loading file:"+i[a])),"SCRIPT"==t[a]&&(b.getScript(i[a],function(){b(s[a])&&new z(i[a],u);j=j+o[a];f.updatePercentage(j);debugMode==true&&console.log("File Loaded:"+i[a])}),!0==debugMode&&console.log("Loading file:"+i[a])),"VIDEO"==t[a]||"AUDIO"==t[a])){var c=H;k[c]=document.getElementById(s[a]);k[c].src=i[a];var e=o[a],g=0,h=0;k[c].addEventListener("progress",I[c]=function(){if(k[c].buffered!=void 0){k[c].buffered.length>0&&(g=e/k[c].duration*k[c].buffered.end(0));
h=g-h;o[a]=o[a]-h;j=j+h;f.updatePercentage(j);h=g;debugMode==true&&console.log("File Loading in progress:"+i[a])}},!0);k[c].addEventListener("canplaythrough",J[c]=function(){b(s[a])&&new z(i[a],k[c]);k[c].removeEventListener("progress",I[c],true);k[c].removeEventListener("canplaythrough",J[c],true);j=j+o[a];f.updatePercentage(j);debugMode==true&&console.log("File Loaded:"+i[a])},!0);H++;!0==debugMode&&console.log("Loading file:"+i[a])}})};f.updatePercentage=function(a){m=~~(100*(a/A)|0)+1;!0==debugMode&&
console.log("Percentage: "+~~m+"%");"line"==e.preloaderType&&Modernizr.canvas&&f.drawLinePreloader(m);"circular"==e.preloaderType&&Modernizr.canvas&&f.draw_CircularPreloader(m);"big-counter"==e.preloaderType&&Modernizr.canvas&&f.draw_BigCounterPreloader(m)};f.onComplete=function(){100<=p&&(null!=C&&new C,d.delay(1E3).fadeOut(function(){g.unbind("CenterCanvas");b(this).remove()}))};f.drawLinePreloader=function(a){!0==debugMode&&console.log("Drawing line");b({perc:p}).animate({perc:a},{duration:1E3,
step:function(){if(101>this.perc){p=a;var b=d.innerWidth(),f=d.innerHeight(),c=h.getContext("2d"),g=b/100*this.perc;c.clearRect(0,0,b,f);c.restore();c.beginPath();c.font=y;c.fillStyle=q;c.fillText((this.perc|0)+"%",n-8,l-15);c.lineWidth=B;c.strokeStyle=q;null!=r&&(c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=10,c.shadowColor=r);c.moveTo(n-b/2,l);c.lineTo(g,l);c.stroke();c.save()}},complete:f.onComplete})};f.draw_CircularPreloader=function(a){!0==debugMode&&console.log("Drawing circle");!0==debugMode&&
console.log(a);b({perc:p}).animate({perc:a},{queque:!1,duration:1E3,step:function(){if(101>this.perc){p=a;var b=h.getContext("2d");G=0.02*this.perc*E+F;b.clearRect(0,0,d.width(),d.height());b.restore();b.beginPath();b.font=y;b.fillStyle=q;b.fillText((this.perc|0)+"%",n-10,l+3);b.lineWidth=B;b.strokeStyle=q;null!=r&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=10,b.shadowColor=r);b.arc(n,l,L,F,G,!1);b.stroke();b.save()}},complete:f.onComplete})};f.draw_BigCounterPreloader=function(a){!0==debugMode&&
console.log("Drawing circle");!0==debugMode&&console.log(a);b({perc:p}).animate({perc:a},{queque:!1,duration:1E3,step:function(){if(101>this.perc){p=a;var b=d.innerWidth(),f=d.innerHeight(),c=h.getContext("2d");c.save();var g=b/100*this.perc;c.clearRect(0,0,b,f);c.restore();c.beginPath();c.font=y;c.fillStyle=q;c.fillText((this.perc|0)+"%",n-8,l-15);c.lineWidth=f;c.strokeStyle=q;null!=r&&(c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=10,c.shadowColor=r);c.moveTo(n-b/2,l);c.lineTo(g,l);c.globalCompositeOperation=
"xor";c.stroke();c.restore()}},complete:f.onComplete})};f.init=function(a){!0==debugMode&&console.log("Start application!");!v&&0==m&&alert("plese insert a path to json file");v&&Modernizr.audio&&Modernizr.video&&b.getJSON(v,function(a){var c=a.files;b.each(a.files,function(a,d){var g=null,e=null,h=null,i=null,g=d.type,j=(""+(new Date).getTime()).replace(/\D/gi,"");switch(g){case "IMAGE":e=d.source;h=d.size;i=b('img[src="'+e+'"]');b(i).attr("src",e+"?"+j);break;case "VIDEO":i=d.videoId;b("#"+i).attr("preload",
"auto");M&&(e=d.mp4.source,h=d.mp4.size);N&&(e=d.ogg.source,h=d.ogg.size);O&&(e=d.webm.source,h=d.webm.size);break;case "AUDIO":i=d.audioId;b("#"+i).attr("preload","auto");""!=Modernizr.audio.ogg&&!1!=Modernizr.audio.ogg?(e=d.ogg.source,h=d.ogg.size):(e="we can't detect preferred browser audio format",h=0);break;case "SCRIPT":e=d.source;h=d.size;i=e;break;default:console.log("something was wrong during json loading!")}f.fillFilesArray(i,h,e,g);!0==(a==c.length-1)&&f.startLoadElements()})});if(Modernizr.canvas)!0==
D?f.setFullscreen():(b(d).html('<canvas id="html5Canvas'+x+'" width="'+b(d).width()+'px "height="'+b(d).height()+'px"></canvas>'),h=document.getElementById("html5Canvas"+x)),v&&f.updatePercentage(0),"line"==a.preloaderType&&f.drawLinePreloader(m),"circular"==a.preloaderType&&f.draw_CircularPreloader(m),"big"==a.preloaderType&&f.draw_BigCounterPreloader(m);else{!0==debugMode&&console.log("Fallback");if(!0==D){var e=d.append('<img src="'+w+'" alt="loading page..." /> '),a=d.find("img").attr("src",w);
a.css({position:"fixed",top:g.height()/2-a.height()/2,left:g.width()/2-a.width()/2,"z-index":99});d.css({position:"fixed",height:g.height(),width:g.width(),"z-index":98});g.bind("resize.CenterCanvas",function(){var a=d.find("img").attr("src",w);a.css({top:g.height()/2-a.height()/2,left:g.width()/2-a.width()/2});d.css({position:"fixed",height:g.height(),width:g.width()})})}else e=d.append('<img src="'+w+'" alt="loading page..." /> '),e.css({"float":"left",marginLeft:n,marginTop:l});g.ready(function(){e.delay(1E3).fadeOut(function(){b(this).remove()})})}};
return f.init(e)}})})(jQuery);